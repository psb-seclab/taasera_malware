from malware.utils import bytes2human
from django.db import models
from django.utils.html import format_html


# Create your models here.
class Malware(models.Model):
    #category = models.ForeignKey(Category)
    md5 = models.CharField(max_length=32, unique=True)
    path = models.CharField(max_length=200, default='')
    is_new = models.BooleanField(default=False)
    date_added = models.DateField(auto_now_add=True)
    virustotal_link = models.URLField()
    malwr_link = models.URLField()
    file_type = models.CharField(max_length=50, default='')
    file_size = models.IntegerField(default=0)

    def sample_size(self):
        return bytes2human(self.file_size)

    def VirusTotal_analysis(self):
    	if len(self.virustotal_link) > 8:
    		return format_html('<a href="{}" target="_blank">{}</a>',
                           self.virustotal_link,
                           'VirusTotal Report')
    	else:
    		return 'Not Available'
	
	VirusTotal_analysis.allow_tags = True

    def __unicode__(self):      #For Python 2, use __str__ on Python 3
        return self.md5
