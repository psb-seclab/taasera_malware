import paramiko
from scp import SCPClient
import os, datetime

server = '45.55.189.232'
port = 22
user = 'taasera'
password = 'n0way2hack$'

archive_dir = "/home/honeydrive/taasera/maltrieve/archive"
dest_dir = "/home/taasera/taasera_malware_repository/"

def createSSHClient(server, port, user, password):
	client = paramiko.SSHClient()
	client.load_system_host_keys()
	client.set_missing_host_key_policy(paramiko.AutoAddPolicy())
	client.connect(server, port, user, password)
	return client

if __name__ == '__main__':
	#main()
	print 'Connecting to ' + server + '...'
	ssh = createSSHClient(server, port, user, password)
	scp = SCPClient(ssh.get_transport())
	print 'Connected'

	today = datetime.date.today()
	today_str = today.isoformat()

	dict_sample = {}

	files = [f for f in os.listdir(archive_dir) if os.path.isfile(os.path.join(archive_dir,f))]

	for item in files:
		dict_sample[item] = os.path.join(archive_dir, item)

	
	cnt = 0
	dest_path = os.path.join(dest_dir, today_str)
	print 'Samples go to', dest_path
	for k in dict_sample:
		cnt += 1
		path_2_bin =  dict_sample[k]
		print cnt, '[Put]', dict_sample[k] 
		scp.put(path_2_bin, dest_path)

	scp.close()
