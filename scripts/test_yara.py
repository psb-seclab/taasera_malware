import yara
from os.path import expanduser
import os

print 'yara loaded...'
home = expanduser("~")
rules_path = os.path.join(home, 'tools/rules')
mal_dir = os.path.join(home, 'taasera_malware_repository')
date_str = '2015-08-03'

rules_basic = {}
rules_malware = {}

for item in os.listdir(rules_path):
	if item.endswith('.yar'):
		rules_basic[item.replace('.yar', '')] = os.path.join(rules_path, item)


for item in os.listdir(os.path.join(rules_path, 'malware')):
	if item == "general_cloaking.yar" or item == "APT_threatgroup_3390.yar" or item == "APT_Cloudduke.yar":
		continue
	if item.endswith('.yar'):
		rules_malware[item.replace('.yar', '')] = os.path.join(rules_path, 'malware/'+item)

rules1 = yara.compile(filepaths=rules_basic)
rules2 = yara.compile(filepaths=rules_malware)

rules1.save(home+'/rules_basic')
rules2.save(home+'/rules_malware')

exit(0)


for item in os.listdir(os.path.join(mal_dir, date_str)):
	
	print item





